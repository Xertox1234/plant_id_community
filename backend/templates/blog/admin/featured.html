{% extends 'blog/admin/base.html' %}

{% block content %}
<!-- Featured Posts Section -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Currently Featured Posts</h5>
            </div>
            <div class="card-body">
                {% for post in featured_posts %}
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div>
                            <h6>{{ post.title }}</h6>
                            <small class="text-muted">Published: {{ post.first_published_at|date:"M j, Y" }}</small>
                        </div>
                        <div>
                            <button class="btn btn-warning btn-sm" onclick="toggleFeatured({{ post.id }})">
                                <i class="bi bi-star-fill me-1"></i>Unfeature
                            </button>
                            <a href="/cms/pages/{{ post.id }}/" class="btn btn-outline-primary btn-sm">
                                <i class="bi bi-pencil me-1"></i>Edit
                            </a>
                        </div>
                    </div>
                    {% if not forloop.last %}<hr>{% endif %}
                {% empty %}
                    <div class="text-center py-4">
                        <i class="bi bi-star text-muted" style="font-size: 3rem;"></i>
                        <h5 class="mt-2">No featured posts</h5>
                        <p class="text-muted">Select posts from the recent posts below to feature them.</p>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Recent Posts to Feature -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Recent Posts (Available to Feature)</h5>
            </div>
            <div class="card-body">
                {% for post in recent_posts %}
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div>
                            <h6>{{ post.title }}</h6>
                            <small class="text-muted">Published: {{ post.first_published_at|date:"M j, Y" }}</small>
                            {% if post.introduction %}
                                <p class="mb-0 text-muted small">{{ post.introduction|striptags|truncatechars:100 }}</p>
                            {% endif %}
                        </div>
                        <div>
                            <button class="btn btn-outline-warning btn-sm" onclick="toggleFeatured({{ post.id }})">
                                <i class="bi bi-star me-1"></i>Feature
                            </button>
                            <a href="/cms/pages/{{ post.id }}/" class="btn btn-outline-primary btn-sm">
                                <i class="bi bi-pencil me-1"></i>Edit
                            </a>
                        </div>
                    </div>
                    {% if not forloop.last %}<hr>{% endif %}
                {% empty %}
                    <div class="text-center py-4">
                        <i class="bi bi-file-earmark text-muted" style="font-size: 3rem;"></i>
                        <h5 class="mt-2">No recent posts</h5>
                        <p class="text-muted">Create some blog posts first to feature them.</p>
                        <a href="/cms/pages/" class="btn btn-primary">
                            <i class="bi bi-plus-circle me-2"></i>Create New Post
                        </a>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function toggleFeatured(postId) {
    fetch(`/blog-admin/posts/${postId}/toggle-featured/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json',
        }
    }).then(response => {
        if (response.ok) {
            location.reload();
        } else {
            alert('Error updating featured status');
        }
    });
}
</script>
{% endblock %}